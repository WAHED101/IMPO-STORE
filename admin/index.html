<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  
  <script>
      // Your Firebase configuration (must match the one in login page)
      const firebaseConfig = {
    apiKey: "AIzaSyATm8V-vInYwYR0KPH1Kf06BzjjJ4xeQXU",
    authDomain: "impo-b098d.firebaseapp.com",
    databaseURL: "https://impo-b098d-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "impo-b098d",
    storageBucket: "impo-b098d.firebasestorage.app",
    messagingSenderId: "498933533524",
    appId: "1:498933533524:web:aabb9888f4793025a0d6c1",
    measurementId: "G-7DZ2PNKY8N"
  };

      // Initialize Firebase
      const app = firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();

      // Check authentication state
      auth.onAuthStateChanged((user) => {
          if (!user) {
              // User is not logged in, redirect to login page
              window.location.href = 'login.html'; // or whatever your login page is called
          }
          // else: user is logged in, show the page normally
      });

      // Logout functionality
      document.getElementById('logoutBtn').addEventListener('click', () => {
          auth.signOut()
              .then(() => {
                  // Sign-out successful, redirect to login page
                  window.location.href = 'login.html';
              })
              .catch((error) => {
                  console.error('Logout error:', error);
              });
      });
  </script>
</head>
<body>
    <div class="admin-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>AdminPro</h2>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="products">
                        <i class="fas fa-box-open"></i>
                        <span>Products</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="request">
                        <i class="fas fa-users"></i>
                        <span>Request</span>
                    </a>
                </li>
            </ul>
        </aside>

        <main class="main-content">
            <div class="header">
                <h1 id="page-title">Dashboard Overview</h1>
                <div class="user-info">
                    <div class="user-avatar">AD</div>
                    <span>Admin User</span>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div class="content-section active" id="dashboard-section">
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Total Users</h3>
                            <div class="card-icon users">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="card-value">1,248</div>
                        <p class="card-desc">+12% from last month</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Total Orders</h3>
                            <div class="card-icon orders">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                        </div>
                        <div class="card-value">356</div>
                        <p class="card-desc">+5% from last week</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Products</h3>
                            <div class="card-icon products">
                                <i class="fas fa-boxes"></i>
                            </div>
                        </div>
                        <div class="card-value">89</div>
                        <p class="card-desc">3 new this month</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Revenue</h3>
                            <div class="card-icon revenue">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                        </div>
                        <div class="card-value">$24,580</div>
                        <p class="card-desc">+18% from last quarter</p>
                    </div>
                </div>

                <h2 class="section-title">Recent Activity</h2>
                <div class="card">
                    <p>Activity feed would go here...</p>
                </div>
            </div>

            <!-- Products Section -->
            <div class="content-section" id="products-section">
                <div class="card">
                    <h2 class="section-title">Product Management</h2>
                    <button class="btn btn-primary" id="add-product-btn">
                        <i class="fas fa-plus"></i> Add New Product
                    </button>
                    
                    <h1>Gems and Ranklist</h1>
                    <div id="loading">Loading data...</div>
                    <table id="gemTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Image</th>
                                <th>Price</th>
                                <th>Popular</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="gemTableBody">
                            <!-- Data will be inserted here -->
                        </tbody>
                    </table>
                
                </div>
                
                <!-- Add Product Form (hidden by default) -->
                <div class="card" id="add-product-form" style="display: none;">
                    <h3>Add New Minecraft Product</h3>
                    <form id="minecraft-product-form">
                        <div class="form-group">
                            <label for="product-name">Product Name</label>
                            <input type="text" id="product-name" placeholder="e.g., Diamond Package" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="product-category">Category</label>
                            <select id="product-category" required>
                                <option value="">Select a category</option>
                                <option value="ranks">Server Ranks</option>
                                <option value="gems">Gems Packages</option>
                                <option value="votes">add vote site</option>
                           
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="product-price">Price (à§³)</label>
                            <input type="number" id="product-price" step="0.01" placeholder="e.g., 9.99" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="product-stock">Available Stock</label>
                            <input type="number" id="product-stock" placeholder="Leave empty for unlimited" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="product-image">Image URL</label>
                            <input type="url" id="product-image" placeholder="e.g., IMG/gem-package.png">
                        </div>
                        
                        <div class="form-group">
                            <label for="product-description">Description</label>
                            <textarea id="product-description" placeholder="Describe the product benefits and features"></textarea>
                        </div>
                        
                        <div class="form-group" id="rank-features-group" style="display: none;">
                            <label for="rank-features">Rank Features (One per line)</label>
                            <textarea id="rank-features" placeholder="e.g., Fly ability\nVIP chat prefix\n3 Homes"></textarea>
                        </div>
                        
                        <div class="form-group" id="gem-amount-group" >
                            <label for="gem-amount">Gem Amount</label>
                            <input type="number" id="gem-amount" placeholder="e.g., 500">
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-success">Save Product</button>
                            <button type="button" class="btn btn-danger" id="cancel-add-product">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Request Section -->
            <div class="content-section" id="request-section">
                <div class="card">
                  <h2 class="section-title">Purchase Requests</h2>
                  
                  <div class="table-controls">
                    <div class="search-box">
                      <input type="text" id="search-requests" placeholder="Search requests...">
                      <button class="btn btn-primary"><i class="fas fa-search"></i></button>
                    </div>
                    <div class="filter-options">
                      <select id="status-filter">
                        <option value="all">All Statuses</option>
                        <option value="pending">Pending</option>
                        <option value="completed">Completed</option>
                        <option value="rejected">Rejected</option>
                      </select>
                    </div>
                  </div>
                  
                  <div class="table-responsive">
                    <table id="requests-table">
                      <thead>
                        <tr>
                          <th>ID</th>
                          <th>Minecraft Username</th>
                          <th>Discord</th>
                          <th>Item</th>
                          <th>Price</th>
                          <th>Payment Method</th>
                          <th>Date</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="requests-body">
                        <!-- Requests will be loaded here dynamically -->
                      </tbody>
                    </table>
                  </div>
                  
                  <div class="pagination">
                    <button id="prev-page" class="btn btn-secondary">Previous</button>
                    <span id="page-info">Page 1 of 1</span>
                    <button id="next-page" class="btn btn-secondary">Next</button>
                  </div>
                </div>
              </div>

     
    <!-- Add these before your custom JS -->
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>

<script src="script.js">
</script>

<script>
    
let requestsRef = database.ref('purchases');

// Pagination variables
let currentPage = 1;
const itemsPerPage = 10;

// Function to format timestamp
function formatTimestamp(timestamp) {
  if (!timestamp) return 'N/A';
  const date = new Date(timestamp);
  return date.toLocaleString();
}

// Function to render requests
function renderRequests(requests) {
  const tbody = document.getElementById('requests-body');
  tbody.innerHTML = '';
  
  if (requests.length === 0) {
    tbody.innerHTML = '<tr><td colspan="9" class="text-center">No requests found</td></tr>';
    return;
  }
  
  requests.forEach((request, index) => {
    const tr = document.createElement('tr');
    const statusClass = {
      'pending': 'warning',
      'completed': 'success',
      'rejected': 'danger'
    }[request.status] || 'secondary';
    
    tr.innerHTML = `
      <td>${request.key.substring(0, 8)}</td>
      <td>${request.minecraftUsername || 'N/A'}</td>
      <td>${request.discordUsername || 'N/A'}</td>
      <td>${request.itemName || 'N/A'}</td>
      <td>${request.itemPrice || 'N/A'}</td>
      <td>${request.paymentMethod ? request.paymentMethod.charAt(0).toUpperCase() + request.paymentMethod.slice(1) : 'N/A'}</td>
      <td>${formatTimestamp(request.timestamp)}</td>
      <td>
        <span class="badge badge-${statusClass}">
          ${request.status ? request.status.charAt(0).toUpperCase() + request.status.slice(1) : 'Pending'}
        </span>
      </td>
      <td>
        <button class="btn btn-primary btn-view" data-id="${request.key}">
          <i class="fas fa-eye"></i>
        </button>
        <button class="btn btn-success btn-complete" data-id="${request.key}" ${request.status === 'completed' ? 'disabled' : ''}>
          <i class="fas fa-check"></i>
        </button>
        <button class="btn btn-danger btn-reject" data-id="${request.key}" ${request.status === 'rejected' ? 'disabled' : ''}>
          <i class="fas fa-times"></i>
        </button>
      </td>
    `;
    tbody.appendChild(tr);
  });
  
  // Add event listeners to action buttons
  document.querySelectorAll('.btn-view').forEach(btn => {
    btn.addEventListener('click', () => viewRequestDetails(btn.dataset.id));
  });
  
  document.querySelectorAll('.btn-complete').forEach(btn => {
    btn.addEventListener('click', () => updateRequestStatus(btn.dataset.id, 'completed'));
  });
  
  document.querySelectorAll('.btn-reject').forEach(btn => {
    btn.addEventListener('click', () => updateRequestStatus(btn.dataset.id, 'rejected'));
  });
}

// Function to fetch requests with pagination
function fetchRequests(page = 1) {
  requestsRef.once('value').then(snapshot => {
    const allRequests = [];
    snapshot.forEach(childSnapshot => {
      allRequests.push({
        key: childSnapshot.key,
        ...childSnapshot.val()
      });
    });
    
    // Apply filters
    let filteredRequests = [...allRequests];
    const statusFilter = document.getElementById('status-filter').value;
    const searchQuery = document.getElementById('search-requests').value.toLowerCase();
    
    if (statusFilter !== 'all') {
      filteredRequests = filteredRequests.filter(req => req.status === statusFilter);
    }
    
    if (searchQuery) {
      filteredRequests = filteredRequests.filter(req => 
        (req.minecraftUsername && req.minecraftUsername.toLowerCase().includes(searchQuery)) ||
        (req.discordUsername && req.discordUsername.toLowerCase().includes(searchQuery)) ||
        (req.itemName && req.itemName.toLowerCase().includes(searchQuery))
      );
    }
    
    // Sort by timestamp (newest first)
    filteredRequests.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
    
    // Pagination
    const totalPages = Math.ceil(filteredRequests.length / itemsPerPage);
    const startIndex = (page - 1) * itemsPerPage;
    const paginatedRequests = filteredRequests.slice(startIndex, startIndex + itemsPerPage);
    
    renderRequests(paginatedRequests);
    
    // Update pagination controls
    document.getElementById('page-info').textContent = `Page ${page} of ${totalPages}`;
    document.getElementById('prev-page').disabled = page === 1;
    document.getElementById('next-page').disabled = page === totalPages;
    
    currentPage = page;
  });
}

// Function to view request details
function viewRequestDetails(requestId) {
  requestsRef.child(requestId).once('value').then(snapshot => {
    const request = snapshot.val();
    
    // Show details in a modal or alert
    const details = `
      Minecraft Username: ${request.minecraftUsername || 'N/A'}
      Discord: ${request.discordUsername || 'N/A'}
      Phone: ${request.phoneNumber || 'N/A'}
      Item: ${request.itemName || 'N/A'}
      Price: ${request.itemPrice || 'N/A'}
      Payment Method: ${request.paymentMethod || 'N/A'}
      Status: ${request.status || 'pending'}
      Date: ${formatTimestamp(request.timestamp)}
    `;
    
    alert(details.replace(/      /g, '\n'));
  });
}

// Function to update request status
function updateRequestStatus(requestId, status) {
  if (!confirm(`Are you sure you want to mark this request as ${status}?`)) return;
  
  requestsRef.child(requestId).update({ status })
    .then(() => {
      alert('Request status updated successfully!');
      fetchRequests(currentPage);
    })
    .catch(error => {
      console.error('Error updating request:', error);
      alert('Failed to update request status');
    });
}

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
  // Load initial requests
  fetchRequests();
  
  // Setup event listeners
  document.getElementById('search-requests').addEventListener('input', () => {
    fetchRequests(1);
  });
  
  document.getElementById('status-filter').addEventListener('change', () => {
    fetchRequests(1);
  });
  
  document.getElementById('prev-page').addEventListener('click', () => {
    if (currentPage > 1) fetchRequests(currentPage - 1);
  });
  
  document.getElementById('next-page').addEventListener('click', () => {
    fetchRequests(currentPage + 1);
  });
});



const ranklistRef = database.ref('ranklist');

// Function to delete an item
function deleteItem(key) {
    if (confirm('Are you sure you want to delete this item?')) {
        ranklistRef.child(key).remove()
            .then(() => {
                console.log('Item deleted successfully');
            })
            .catch((error) => {
                console.error('Error deleting item:', error);
                alert('Error deleting item');
            });
    }
}

// Fetch data
ranklistRef.on('value', (snapshot) => {
    const data = snapshot.val();
    const tableBody = document.getElementById('gemTableBody');
    tableBody.innerHTML = ''; // Clear existing data
    
    if (!data) {
        document.getElementById('loading').textContent = 'No data available';
        return;
    }

    document.getElementById('loading').style.display = 'none';
    
    // Iterate through each item
    Object.keys(data).forEach(key => {
        const item = data[key];
        
        // Only display items that have price information (gems)
        if (item.price) {
            const row = document.createElement('tr');
            
            row.innerHTML = `
                <td>${item.id || 'N/A'}</td>
                <td>${item.name || 'N/A'}</td>
                <td>${item.description || 'N/A'}</td>
                <td>${item.image ? `<img src="${item.image}" alt="${item.name || 'Gem'}">` : 'N/A'}</td>
                <td>${item.price || 'N/A'}</td>
                <td>${item.popular ? 'Yes' : 'No'}</td>
                <td><button class="delete-btn" onclick="deleteItem('${key}')">Delete</button></td>
            `;
            
            tableBody.appendChild(row);
        }
    });
    
    if (tableBody.children.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="7">No gem items found</td></tr>';
    }
}, (error) => {
    console.error('Error fetching data:', error);
    document.getElementById('loading').textContent = 'Error loading data';
});

</script>
</body>
</html>
